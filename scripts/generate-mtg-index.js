#!/usr/bin/env node

/**
 * Auto-generate MTG card images index file
 * This script scans the mtg-cards directory and generates the index.ts file
 * with all the necessary imports and exports.
 */

import fs from 'fs';
import path from 'path';
import { fileURLToPath } from 'url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

const MTG_CARDS_DIR = path.join(__dirname, '../src/assets/mtg-cards');
const INDEX_FILE = path.join(MTG_CARDS_DIR, 'index.ts');

// Convert filename to valid variable name
function filenameToVariableName(filename) {
  // Remove extension and convert to camelCase variable name
  const baseName = filename.replace('.jpg', '');
  return baseName
    .split('-')
    .map((part, index) => {
      if (index === 0) {
        // First part: replace numbers and special characters
        let strngfd = part.replace(/[^a-zA-Z0-9]/g, '');
        // Append a letter if the very first symbol is a number.
        if (/^\d/.test(strngfd)) {
          strngfd = 'a' + strngfd;
        }
        return strngfd;
      }
      // Subsequent parts: capitalize first letter
      return part.charAt(0).toUpperCase() + part.slice(1).replace(/[^a-zA-Z0-9]/g, '');
    })
    .join('') + 'Img';
}

function generateIndexFile() {
  try {
    // Read all .jpg files in the directory
    const files = fs.readdirSync(MTG_CARDS_DIR)
      .filter(file => file.endsWith('.jpg'))
      .sort(); // Sort alphabetically for consistent output

    console.log(`Found ${files.length} MTG card images`);

    // Generate imports section
    const imports = files.map(filename => {
      const variableName = filenameToVariableName(filename);
      return `import ${variableName} from './${filename}';`;
    }).join('\n');

    // Generate export map entries
    const exportEntries = files.map(filename => {
      const variableName = filenameToVariableName(filename);
      const key = filename.replace('.jpg', '');
      return `  '${key}': ${variableName},`;
    }).join('\n');

    // Generate the complete file content
    const fileContent = `// MTG Card Image Imports
// This file imports all MTG card images for proper bundling in GitHub Pages deployment
// Auto-generated by scripts/generate-mtg-index.js - DO NOT EDIT MANUALLY

${imports}

// Export as a map for easy lookup by filename
export const mtgCardImages: { [key: string]: string } = {
${exportEntries}
};
`;

    // Write the file
    fs.writeFileSync(INDEX_FILE, fileContent);
    console.log('‚úÖ Successfully generated index.ts with all MTG card images');
    console.log(`üìÑ File location: ${INDEX_FILE}`);
    
  } catch (error) {
    console.error('‚ùå Error generating index file:', error);
    process.exit(1);
  }
}

// Run the script
generateIndexFile();
